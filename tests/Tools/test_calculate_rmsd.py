import pathlib
import argparse
from pathlib import Path
import pytest
from Tools.calculate_rmsd import *


def test_calculate_rmsd():

    xyzfile = ClassGeometryXYZs(
        Path("tests/data/crest_conformers.xyz"))
    xyzfile.method_read_xyz()

    x: dict = {"remove_idx": None, "add_idx": None, "bond_broken": None,
               "ignore_Hydrogen": False, "debug": False}
    idx_atom1 = main_xyz(xyzfile, 1, 2, args=argparse.Namespace(**x))
    assert idx_atom1 == ({1: 0.04168495003696687, 2: 0.2628262508618869, 3: 0.30096523890041704, 4: 0.7115437494171742, 5: 0.3551688571579894, 6: 0.11902032404243405, 7: 0.2930424198735639, 8: 0.08998310505998885, 9: 0.6340098313070369, 10: 0.6553983465146661, 11: 0.024492291941633687, 12: 0.286203758877868, 13: 0.8763539979706841, 14: 0.5316252375179794, 15: 0.11878606837284014, 16: 0.47050946685220374, 17: 0.5196183576930099, 18: 1.0272586280768994, 19: 0.0914344992629174, 20: 0.4563183313804463, 21: 0.14661346427388777, 22: 0.26976043034295427, 23: 0.5009430869497944, 24: 0.5171440495390505, 25: 0.7873573097922943, 26: 0.9895827026271603, 27: 0.15861106553891824, 28: 0.6203533741642736, 29: 1.1766301407257822, 30: 0.056437459649229985, 31: 0.2671754301394416, 32: 0.384471132514391, 33: 0.2695225249401574, 34: 0.6493465499229614, 35: 0.8927358473893148, 36: 0.815449715567247,
                         37: 1.1011797914188353, 38: 1.5579199462466364, 39: 0.992168125786902, 40: 0.37954136907618385, 41: 1.6632397180270098, 42: 1.5538628919654944, 43: 0.4601815318248761, 44: 0.578465551574061, 45: 0.33778633630565125, 46: 0.7797688972808443, 47: 0.3210931813375009, 48: 0.6626814715090487, 49: 0.9546932142674583, 50: 0.28962324312819454, 51: 1.493025857746037, 52: 0.7591506462076681, 53: 9.251175457125107, 54: 6.567638759452888, 55: 0.7493760567735199, 56: 11.64119892561306, 57: 3.148788995458106, 58: 4.348321001412071, 59: 11.37026957892754, 60: 13.905411118794275, 61: 1.8506422349838887, 62: 19.76670064546329, 63: 13.310389755760944, 64: 22.38451149643028, 65: 16.054140832539375, 66: 17.662885175849222, 67: 28.293074254908973, 68: 3.0689262463368303, 69: 9.383612367000271, 70: 2.335871872343435, 71: 0.29486863219665715, 72: 0.08073163906772865, 73: 0.6171893109308431}, 1.7608313888081009)

    x = {"remove_idx": None, "add_idx": None, "bond_broken": [
        52, 55], "ignore_Hydrogen": True, "debug": False}
    idx_atom1 = main_xyz(xyzfile, 1, 2, args=argparse.Namespace(**x))
    assert idx_atom1 == ({1: 0.0022804570676915915, 2: 0.018027790596346783, 3: 0.01709254227652934, 6: 0.008160878536050848, 7: 0.003727083053746029, 8: 0.006249341578559444, 13: 0.022634980266270806, 15: 0.000775549327508132, 16: 0.033430439706511494, 19: 0.005462799228824608, 21: 0.009959506233047493, 23: 0.020055830263314752,
                         24: 0.02272775019255817, 27: 0.013301639791932156, 30: 0.010415641436928958, 33: 0.032231106671973125, 35: 0.09202166713655999, 37: 0.08723548898391156, 40: 0.04225938056449564, 44: 0.04705331272802704, 45: 0.01768911844707725, 50: 0.04266095622718927, 51: 0.15171346459903834, 52: 2.3962159993169423}, 0.35959367835047723)
